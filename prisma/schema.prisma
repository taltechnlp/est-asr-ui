generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model File {
  id                       String       @id @db.VarChar(30)
  state                    String       @default("UPLOADED")
  text                     String?
  path                     String
  filename                 String
  duration                 Decimal?
  uploadedAt               DateTime?
  mimetype                 String
  encoding                 String
  externalId               String?
  textTitle                String?
  initialTranscriptionPath String?
  initialTranscription     String?
  uploader                 String?      @db.VarChar(30)
  language                 String
  notified                 Boolean?
  notify                   Boolean?
  User                     User?        @relation(fields: [uploader], references: [id], onDelete: Cascade, onUpdate: NoAction)
  NfWorkflow               NfWorkflow[]
}

model NfProcess {
  id          String     @id
  task_id     Int
  process     String
  tag         String?
  hash        String
  status      NfStatus
  submit      DateTime?
  cpu         Float?
  mem         Float?
  peak_rss    Float?
  peak_vmem   Float?
  rchar       Float?
  wchar       Float?
  vol_ctxt    Int?
  inv_ctxt    Int?
  workflow_id String
  start       DateTime?
  exit        DateTime?
  duration    Int?
  realtime    Int?
  complete    DateTime?
  NfWorkflow  NfWorkflow @relation(fields: [workflow_id], references: [run_id], onDelete: Cascade)
}

model NfWorkflow {
  run_id         String      @unique
  run_name       String      @unique
  file_id        String
  event          NfEvent
  utc_time       DateTime
  failedCount    Int?
  pendingCount   Int?
  progressLength Int?
  runningCount   Int?
  succeededCount Int?
  NfProcess      NfProcess[]
  File           File        @relation(fields: [file_id], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Account {
  id                    String    @id
  userId                String
  scope                 String?
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  provider              String
  providerAccountId     String
  type                  String    @default("oauth")
  User                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("account")
}

model Session {
  id        String   @id
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model User {
  id               String    @id @default(nanoid(25)) @db.VarChar(30)
  email            String    @unique(map: "default$default.User.email._UNIQUE")
  name             String
  password         String?
  resetToken       String?
  resetTokenExpiry BigInt?
  role             Role      @default(USER)
  emailVerified    DateTime?
  image            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now()) @updatedAt
  File             File[]
  Account          Account[]
  Session          Session[]

  @@map("user")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

enum NfEvent {
  started
  process_submitted
  process_started
  process_completed
  error
  completed
}

enum NfStatus {
  PENDING
  SUBMITTED
  RUNNING
  CACHED
  COMPLETED
  ERROR
  FAILED
  ABORTED
}

enum Role {
  USER
  ADMIN
}
